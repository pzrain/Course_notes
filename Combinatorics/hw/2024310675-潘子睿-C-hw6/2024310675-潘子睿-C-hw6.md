## 第六章习题（进阶）

<p align="right">潘子睿 2024310675</p>

### Q4.6

> 难度：3。将其转换为不定方程的解的问题后就简单了（实际上课上讲过）

考虑不定方程：
$$
x_1+x_2+x_3+x_4+x_5+x_6=39
$$
其中$0\leq x_i\leq 9$，$1\leq i\leq 6$。

首先，由于$\sum_{i=1}^6x_i=39>0$，因此一定至少存在一个$j$，使得$x_j>0$，其中$1\leq j\leq 6$。那么将$(x_1\space x_2\space x_3\space x_4\space x_5\space x_6)$看做一个6位的十进制正整数（允许存在前导0），其和$1,2,\cdots,10^6-1$这些正整数一一对应。注意到$10^6$的各位数字之和不等于39，因此所要求的就是上不定方程满足限制条件的解的个数。

使用容斥原理进行求解。

1. 若不考虑限制条件$x_i\leq 9$，$1\leq i\leq 6$，则上不定方程的非负整数解的个数为$C_{39+6-1}^{6-1}=C_{44}^5$。

2. 当某个$x_i\geq 10$时，不妨设$x_1\geq 10$，则上不定方程化为
   $$
   x_1^{'}+10+x_2+x_3+x_4+x_5+x_6=39\\
   \Leftrightarrow x_1^{'}+x_2+x_3+x_4+x_5+x_6=29
   $$
   其中$x_i\geq 0$，$2\leq i\leq 6$，$x_1^{'}\geq 0$。此时解的个数为$C_{29+6-1}^{6-1}=C_{34}^5$。

3. 当某两个$x_i\geq 10$，$x_j\geq 10$，$1\leq i<j\leq 6$时，同理，对应的不定方程解的个数为$C_{39-10\times2+6-1}^{6-1}=C_{24}^5$

4. 当某三个$x_i,x_j,x_k\geq 10$，$1\leq i< j< k\leq 6$时，对应的不定方程解的个数为$C_{39-10\times 3+6-1}^{6-1}=C_{14}^5$。

5. 不可能有四个或以上的$x_i,x_j,x_k,x_l\geq 10$，$1\leq i<j<k<l\leq 6$，否则$\sum_{t=1,t\notin\set{i,j,k,l}}^6x_t=39-x_i-x_j-x_k-x_l\leq -1$，矛盾。

所以原不定方程满足限制条件的解的个数为
$$
C_{44}^5-C_6^1C_{34}^5+C_6^2C_{24}^5-C_6^3C_{14}^5=13992
$$

> 此外，本题可以非常方便地通过程序验证：
>
> ```python
> def count_number(n): # 给定正整数n，计算其各位数之和
>     s = 0
>     while n > 0:
>         s += n % 10
>         n = n // 10
>     return s
> 
> ans = 0
> range_end = int(1e6)+1
> for i in range(range_end):
>     if count_number(i) == 39:
>         ans += 1
>         
> print(ans)
> ```
>
> 最后计算出答案确实也为13992。

### Q6.5

> 难度3：利用容斥原理，讨论至少包含$k$个子串的排列数目即可。虽然$k$个子串可以互不相邻，也可以存在一些相邻，但是其对应的排列数都是$(n-k)!$。

使用容斥原理进行计算。不考虑限制条件时，全集的大小就是$\set{1,2,\cdots,n}$的排列数，也即$n!$。下计算至少包含子串集合$\set{12,23,34,\cdots,(n-1)n,n1}$中$k$个的排列的个数，其中$1\leq k\leq n$。特别地，当$k$取$n$时，易知包含所有子串的排列是不存在的。因此下设$k\leq n-1$。

定义相邻关系：子串$x$和$y$相邻当且仅当存在$i\in\set{1,2,\cdots,n}$，使得$x=(i-1)i$，$y=i(i+1)$或$x=i(i+1)$，$y=(i-1)i$。这里$i$考虑模$n$加$1$意义下，也即设$(n+1)\equiv 1$，$(1-1)\equiv n$。

显然这样定义的相邻关系是一种等价关系，因此我们可以将$k$个子串按照相邻关系划分成$d$个等价类。设第$j$个等价类共包含$h_j$个子串，$1\leq j\leq d$，有$\sum_{j=1}^dh_j=k$。对于第$j$个等价类，其中共包含$d_j+1$个连续的数字，这些子串要同时出现，就意味着这$h_j+1$个连续的数字需要按照顺序排列。那么我们可以将这$h_j+1$个数字聚合成一个元素。这样操作过后，集合$\set{1,2,\cdots,n}$还剩下$d+n-\sum_{j=1}^d(h_j+1)=n-k$个元素，这些元素可以进行任意排列，共有$(n-k)!$种。注意到这和等价类的数量$d$没有关系，因此至少包含子串集合$\set{12,23,34,\cdots,(n-1)n,n1}$中$k$个的排列的个数就为
$$
C_{n}^k(n-k)!
$$
从而根据容斥原理啊，满足题意的排列数目为
$$
n!+\sum_{k=1}^{n-1}(-1)^kC_n^k(n-k)!=\sum_{k=0}^{n-1}(-1)^kC_n^k(n-k)!=n!\sum_{k=0}^{n-1}(-1)^k\frac{1}{k!}
$$

> 本题也可以通过程序验证：
>
> ```python
> from itertools import permutations
> 
> n = 6
> ans = 0
> for item in permutations(list(range(n))): # 遍历所有排列
>     flag = True
>     for i in range(len(item) - 1):
>         if item[i] + 1 == item[i + 1]:
>             flag = False
>         if item[i] == n - 1 and item[i + 1] == 0:
>             flag = False
>     if flag:
>         ans += 1
> 
> print(ans)
> ```
>
> 计算一些$n$对应的答案如下：
>
> | $n$  | Answer |
> | ---- | ------ |
> | 3    | 3      |
> | 4    | 8      |
> | 5    | 45     |
> | 6    | 264    |
>
> 这与通过容斥原理计算出来的答案相同。

### Q6.6

> 难度：2。了解错排问题的话感觉就非常简单了。

题意要求至少4个数不在其原本位置上，因此我们分类讨论恰好有$k$个数不在其原本位置上，$k=4,5,6$。

1. $k=4$，首先取两个数放在正确位置上，剩下就是一个$n=4$的错排问题，共有$C_6^2\cdot4!\cdot(1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+\frac{1}{4!})=135$
2. $k=5$，首先取一个数放在正确位置上，剩下就是一个$n=5$的错排问题，共有$C_6^5\cdot5!\cdot(1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+\frac{1}{4!}-\frac{1}{5!})=264$
3. $k=6$，就是一个$n=6$的错排问题，共有$6!\cdot(1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+\frac{1}{4!}-\frac{1}{5!}+\frac{1}{6!})=265$

所以满足要求的排列数为$135+264+265=664$个。

> 这道题也可以简单通过程序验证：
>
> ```python
> from itertools import permutations
> 
> n = 6
> ans = 0
> for item in permutations(list(range(n))):
>     cnt = 0
>     for i, digit in enumerate(item):
>         if digit != i:
>             cnt += 1
>     if cnt >= 4:
>         ans += 1
> print(ans)
> ```
>
> 计算出来答案确实是664。