## 第四章习题（进阶）

<p align="right">潘子睿 2024310675</p>

### Q4.5

设满足题意的$n$位字符串的数量为$a_n$，则题目即为求$a_n$。再设满足题意的$n$位字符串中，最后一位是$B$的字符串的数量为$b_n$，$n\geq 0$。首先，显然有$a_0=b_0=a_1=b_1=0$，$a_2=b_2=1$。下设$n\geq 2$。考虑该$n$位字符串的最后一位。

1. 若最后一位不是$B$，则为$A,C,D$三者之一，此时前$n-1$位中字串$AB$至少出现一次，因此此时总的情况数为$3a_{n-1}$。
2. 最后一位是$B$，总的情况数为$b_n$。

因此$a_n=3a_{n-1}+b_n$。

考虑最后一位是$B$的$n$位字符串的倒数第二位：

1. 若倒数第二位是$A$，则此时前$n-2$位中的字符可以完全任意，共有$4^{n-2}$种。
2. 若倒数第二位是$B$，则此时前$n-1$位构成一个满足题意的字符串且最后一位是$B$，共$b_{n-1}$种。
3. 若倒数第二位是$C$或$D$，则此时前$n-2$位构成的字符串中$AB$至少出现一次，因此此时总的情况数为$2a_{n-2}$。

因此$b_n=4^{n-2}+b_{n-1}+2a_{n-2}$。

从而
$$
\begin{align}
a_n=&3a_{n-1}+b_n\\
=&3a_{n-1}+2a_{n-2}+4^{n-2}+b_{n-1}\\
=&3a_{n-1}+2a_{n-2}+2a_{n-3}+4^{n-2}+4^{n-3}+b_{n-2}\\
\vdots&\\
=&a_{n-1}+2\sum_{i=1}^{n-1}a_i+\sum_{i=1}^{n-2}4^{i}+b_2\\
=&a_{n-1}+2\sum_{i=1}^{n-1}a_i+\frac{4^{n-1}-1}{3}
\end{align}
$$
令$S_n=\sum_{i=1}^na_i$，$n\geq 1$，则上式化为：
$$
S_n=4S_{n-1}-S_{n-2}+\frac{4^{n-1}-1}{3}
$$
令$T_n=S_n-\frac{4}{3}4^n-\frac{1}{6}$得到
$$
T_n=4T_{n-1}-T_{n-2}
$$
这是一个线性常系数齐次递推方程，其特征方程为
$$
x^2-4x+1=0
$$
解为
$$
x_{1,2}=2\pm\sqrt{3}
$$
因此设
$$
T_n=A(2-\sqrt{3})^{n-1}+B(2+\sqrt{3})^{n-1}
$$
有$T_1=S_1-\frac{4}{3}\cdot 4-\frac{1}{6}=-\frac{11}{2}$，$T_2=S_2-\frac{4}{3}\cdot 16-\frac{1}{6}=-\frac{41}{2}$。代入上式，由待定系数法，得
$$
A=\frac{19\sqrt{3}-33}{12},B=-\frac{19\sqrt{3}+33}{12}
$$
验证可得：$T_n=\frac{19\sqrt{3}-33}{12}(2-\sqrt{3})^{n-1}-\frac{19\sqrt{3}+33}{12}(2+\sqrt{3})^{n-1}$符合上述递推方程与初值条件。

因此
$$
S_n = T_n+\frac{4}{3}4^n+\frac{1}{6}=\frac{19\sqrt{3}-33}{12}(2-\sqrt{3})^{n-1}-\frac{19\sqrt{3}+33}{12}(2+\sqrt{3})^{n-1}+\frac{4^{n+1}}{3}+\frac{1}{6}
$$
从而
$$
\begin{align}
a_n=&S_n-S_{n-1}=\frac{26\sqrt{3}-45}{6}(2-\sqrt{3})^{n-2}-\frac{26\sqrt{3}+45}{6}(2+\sqrt{3})^{n-2}+4^n\\
=&\frac{2\sqrt{3}-3}{6}(2-\sqrt{3})^n-\frac{2\sqrt{3}+3}{6}(2+\sqrt{3})^n+4^n,\quad n\geq 2
\end{align}
$$
注意到这对$n=0,1,2$也成立。

因此
$$
\begin{align}
a_n=&\frac{2\sqrt{3}-3}{6}(2-\sqrt{3})^n-\frac{2\sqrt{3}+3}{6}(2+\sqrt{3})^n+4^n\\
=&\frac{\sqrt{3}}{6}(2-\sqrt{3})^{n+1}-\frac{\sqrt{3}}{6}(2+\sqrt{3})^{n+1}+4^n,\quad n\geq 0
\end{align}
$$

### Q4.6

对于基本的汉诺塔问题，设$n$个圆盘时需要移动的最小次数为$H(n)$，$n\geq 0$，有$H(0)=0$，$H(1)=1$，及$n\geq 1$时，
$$
H(n)=2H(n-1)+1\Longrightarrow H(n)+1=2(H(n-1)+1)=\cdots=2^n(H(0)+1)=2^n
$$
所$H(n)=2^n-1$，对$n=0$也成立。

回原题。设对$n$个圆盘，满足题意时所需的最小移动次数为$S(n)$，$n\geq 0$。有$S(0)=0,S(1)=1,S(2)=2$。下设$n\geq 3$。

1. 考虑第$n$个圆盘，不妨设我们需要将其移动到$B$柱上。在移动第$n$个圆盘之前，我们首先需要将前$(n-1)$个圆盘全部移动到$C$柱上，所需的最小移动步数为$H(n-1)$。因此，此时总的所需的最小移动步数为$H(n-1)+1$。
2. 考虑第$(n-1)$个圆盘，它已经被移动到了$C$柱上，因此不需要进行额外操作。
3. 考虑第$(n-2)$个圆盘，与第一步同理，它需要被移动到$B$柱上，而在此之前，前$(n-3)$（可能为0）个圆盘需要全部被移动到$A$柱上，因此总的所需的最小移动步数为$H(n-3)+1$。
4. 此时第$n,n-1,n-2$个圆盘均已就位，剩下的所有圆盘都在$A$柱上，因此剩余最小移动步数就是$S(n-3)$。

综上，我们得到递推关系：
$$
S(n)=S(n-3)+H(n-1)+H(n-3)+2=S(n-3)+2^{n-1}+2^{n-3},\forall n\geq 3
$$
令$T(n)=S(n)-\frac{5}{7}2^n$，则
$$
T(n)=T(n-3),\forall n\geq 3
$$
从而$\forall k\geq 1$，
$$
\begin{cases}
T(3k)=T(0)=S(0)-\frac{5}{7}=-\frac{5}{7}\\
T(3k+1)=T(1)=S(1)-\frac{5}{7}\cdot 2=-\frac{3}{7}\\
T(3k+2)=T(2)=S(2)-\frac{5}{7}\cdot 4=-\frac{6}{7}
\end{cases}
$$
注意到这对$k=0$也成立。所以
$$
S(n)=\begin{cases}
\frac{5}{7}\cdot 2^n-\frac{5}{7},&\quad n=3k\\
\frac{5}{7}\cdot 2^n-\frac{3}{7},&\quad n=3k+1\\
\frac{5}{7}\cdot 2^n-\frac{6}{7},&\quad n=3k+2\\
\end{cases},\quad\forall k\geq 0
$$

### Q4.7

对于长度为$n$的字符串，设方案数为$S_n$。有$S_1=k$，$S_2=k^2$。下设$n\geq 3$。特别地，设$S_{ns}$表示长度为$n$，且开头为第$s$种字母的满足题意的字符串的数量，$n\geq 1$，$1\leq s\leq k$。由于对称性，有$S_{ns}=\frac{1}{k}S_n$。

对于任意一个满足题意的字符串，设第一位为第$t$种字母，$1\leq t\leq k$。

1. 第二位不是$t$，设为$s$：此时第二位共有$(k-1)$种可能性。而从第二位开始的字符串就是一个长为$(n-1)$，开头是$s$的满足题意的字符串，共有$S_{(n-1)s}$个。因此此时共有$(k-1)S_{(n-1)s}=\frac{k-1}{k}S_{n-1}$种。
2. 第二位是$t$，则第三位一定不是$t$，共有$(k-1)$种可能性，设第三位是$s$。同理，此时从第三位开始的字符串就是一个长为$(n-2)$，开头是$s$的字符串。因此此时共有$(k-1)S_{(n-2)s}=\frac{k-1}{k}S_{n-2}$种。

考虑到第一位可以为$k$种字母之一，我们得到下面的递推关系：
$$
S_n=k\cdot(\frac{k-1}{k}S_{n-1}+\frac{k-1}{k}S_{n-2})=(k-1)S_{n-1}+(k-1)S_{n-2},\space\space n\geq 3
$$
其特征方程为：
$$
x^2-(k-1)x-(k-1)=0
$$
解得
$$
x_{1,2}=\frac{(k-1)\pm\sqrt{(k-1)(k+3)}}{2}
$$
下对$k$的取值分类讨论：

1. $k=1$，则$x_{1,2}=0$，此时$S_n=0$，$\forall n\geq 3$。

2. $k\geq 2$，此时无重根。设
   $$
   S_n=Ax_1^{n-1}+Bx_2^{n-1}
   $$
   代入$S_1=k$，$S_2=k^2$，得
   $$
   \begin{cases}
   A=\frac{k[(k+1)\sqrt{k^2+2k-3}+(k^2+2k-3)]}{2(k^2+2k-3)}\\
   B=-\frac{k[(k+1)\sqrt{k^2+2k-3}-(k^2+2k-3)]}{2(k^2+2k-3)}
   \end{cases}
   $$
   所以
   $$
   \begin{align}
   S_n=&\frac{k[(k+1)\sqrt{k^2+2k-3}+(k^2+2k-3)]}{2(k^2+2k-3)}x_1^{n-1}-\\
   &\frac{k[(k+1)\sqrt{k^2+2k-3}-(k^2+2k-3)]}{2(k^2+2k-3)}x_2^{n-1}\\
   =&\frac{k[(k+1)\sqrt{k^2+2k-3}+(k^2+2k-3)]}{2(k^2+2k-3)}\left(\frac{(k-1)+\sqrt{k^2+2k-3}}{2}\right)^{n-1}-\\
   &\frac{k[(k+1)\sqrt{k^2+2k-3}-(k^2+2k-3)]}{2(k^2+2k-3)}\left(\frac{(k-1)-\sqrt{k^2+2k-3}}{2}\right)^{n-1},\quad n\geq 1
   \end{align}
   $$
   验证可得，$S_n$满足上递推关系。因此这就是所求的方案数。

### Q4.8

令$A_n=\sum_{k=1}^nk^4$，则对$n\geq 2$，有
$$
A_n-A_{n-1}=n^4
$$
则$A_{n-1}-A_{n-2}=(n-1)^2$，$\forall n\geq 3$。两式子相减，得
$$
A_n-2A_{n-1}+A_{n-2}=4n^3-6n^2+4n-1
$$
则$A_{n-1}-2A_{n-2}+A_{n-3}=4(n-1)^3-6(n-1)^2+4(n-1)-1$，$\forall n\geq 4$。两式子相减，得：
$$
A_{n}-3A_{n-1}+3A_{n-2}-A_{n-3}=12n^2-24n+14
$$
则$A_{n-1}-3A_{n-2}+3A_{n-3}-A_{n-4}=12(n-1)^2-24(n-1)+14$，$\forall n\geq 5$。两式子相减，得
$$
A_n-4A_{n-1}+6A_{n-2}-4A_{n-3}+A_{n-4}=24n-36
$$
则$A_{n-1}-4A_{n-2}+6A_{n-3}-4A_{n-4}+A_{n-5}=24(n-1)-36$，$\forall n\geq 6$。两式子相减，得
$$
A_n-5A_{n-1}+10A_{n-2}-10A_{n-3}+5A_{n-4}-A_{n-5}=24
$$
则$A_{n-1}-5A_{n-2}+10A_{n-3}-10A_{n-4}+5A_{n-5}-A_{n-6}=24$，$\forall n\geq 7$。两式子相减，得
$$
A_{n}-6A_{n-1}+15A_{n-2}-20A_{n-3}+15A_{n-4}-6A_{n-5}+A_{n-6}=0
$$
令
$$
A_n=B{n\choose 1}+C{n\choose 2}+D{n\choose 3}+E{n\choose 4}+F{n\choose 5}
$$
代入$A_1=1,A_2=17,A_3=98,A_4=354,A_5=979$，得
$$
\begin{cases}
B=1\\
C=15\\
D=50\\
E=60\\
F=24
\end{cases}
$$
所以$A_n={n\choose 1}+15{n\choose 2}+50{n\choose 3}+60{n\choose 4}+24{n\choose 5}$。经验证，$A_n$满足上述递推关系以及初值条件。因此
$$
\sum_{k=1}^nk^4=A_n={n\choose 1}+15{n\choose 2}+50{n\choose 3}+60{n\choose 4}+24{n\choose 5}
$$

### Q4.9

#### （1）

对$f(n,k)$，考虑数字$n$是否被选择：

1. 选择了数字$n$，则剩下的$k-1$个数字要在$1$到$n-2$之间选择，共有$f(n-2,k-1)$种。
2. 未选择数字$n$，则全部的$k$个数字要在$1$到$n-1$之间选择，共有$f(n-1,k)$种。

因此递推关系为
$$
f(n,k)=f(n-1,k)+f(n-2,k-1),\quad n\geq 3,k\geq 2
$$

#### （2）

下用数学归纳法证明：$f(n,k)=C_{n-k+1}^k$。

首先，当$k=0$时，有$f(n,0)=0=C_{n-0+1}^0$，成立。当$k=1$时，有$f(n,1)=n=C_{n-1+1}^1$，成立。下设$k\geq2$。$n=1$时，有$f(1,k)=0$。$n=2$时，$f(2,k)=0$。均成立。

下假设当$n\leq t$（$t\geq 2$）时成立。考虑$n=t+1$的情形。

有
$$
\begin{align}
f(n,k)=&f(n-1,k)+f(n-2,k-1)\\
=&C_{n-k}^k+C_{n-k}^{k-1}=C_{n-k+1}^k
\end{align}
$$
也成立。故由第二数学归纳法，知$\forall n\in\mathbb{N}^{+},k\in\mathbb{N}$时，有$f(n,k)=C_{n-k+1}^k$。

#### （3）

先假设$1$与$n$不是相邻的数，设从$1$到$n$的正整数种选取$k$个不同且互不相邻的数，且这些数中包含了$1$和 $n$的方案数为$h(n,k)$。因为已经选择了$1$和$n$，因此剩下的$k-2$个数只能在$3$到$n-2$之间取，$k\geq 2$，方案数为$f(n-4,k-2)$。故
$$
h(n,k)=f(n-4,k-2),\quad n\geq 5,k\geq 2
$$
当$n\leq 2$时，$h(n,k)=0$，此时仍然有 $h(n,k)=0=f(n-4,k-2)$成立（扩展$f(n,k)$中$n$的定义域，并令$x<y$时，$C_{x}^y=0$）。

当$n=3,4$时，只有$h(n,2)=1$，当$k\geq 3$时均有$h(n,k)=0$，此时仍然有$h(n,k)=f(n-4,k-2)$成立。

综上，$\forall n\geq 1$，有
$$
h(n,k)=\begin{cases}
0,&k<2\\
f(n-4,k-2)=C_{n-k-1}^{k-2},&k\geq 2
\end{cases}
$$
故
$$
g(n,k)=f(n,k)-h(n,k)=\begin{cases}
C_{n-k+1}^k,\quad k<2\\
C_{n-k+1}^k-C_{n-k-1}^{k-2},\quad k\geq 2
\end{cases}
$$
若设$y<0$时，$\forall x$，$C_x^y=0$，则上式可统一表达为
$$
g(n,k)=C_{n-k+1}^k-C_{n-k-1}^{k-2},\quad\forall n\in\mathbb{N}^{+},k\in\mathbb{N}
$$

### Q4.10

#### （1）

设$A_n$表示铺设$1\times n$路径的方案数，$B_n$表示铺设$1\times n$路径，但最后一个$1\times 1$方块只有按对角线分隔开的一半时的方案数。

1. 对$A_n$，考虑最后一块砖如何铺设，可以铺设一块方砖，或是直角顶点在左上角和右下角的直角边长为1的等腰直角三角形砖，三种情况对应的铺砖方案数分别为$A_{n-1}$，$B_n$，$B_n$。
2. 对$B_n$，同样考虑最后一块砖如何铺设，可以铺设一块直角边长为1的等腰直角三角形砖，或是斜边长为2的等腰直角三角形砖，两种情况对应的铺砖方案数分别为$A_{n-1}$，$B_{n-1}$。

故我们得到两个递推关系：
$$
\begin{cases}
A_n=A_{n-1}+2B_n\\
B_n=A_{n-1}+B_{n-1}
\end{cases}
$$
从而有
$$
\begin{align}
A_n=&A_{n-1}+2B_n\\
=&A_{n-1}+2A_{n-1}+2B_{n-1}\\
=&A_{n-1}+2A_{n-1}+2A_{n-2}+2B_{n-2}\\
\vdots&\\
=&A_{n-1}+2\sum_{i=1}^{n-1}A_i+2B_1
\end{align}
$$
而$B_1=1$，令$S_n=\sum_{i=1}^nA_i+1$，$n\geq 1$，则上式化为
$$
S_n=4S_{n-1}-S_{n-2}
$$
且$S_1=A_1+1=4$，$S_2=A_1+A_2+1=15$。

根据Q4.5，我们有
$$
S_n=A(2-\sqrt{3})^{n-1}+B(2+\sqrt{3})^{n-1}
$$
代入$S_1$，$S_2$，得$A=\frac{12-7\sqrt{3}}{6}$，$B=\frac{12+7\sqrt{3}}{6}$。因此
$$
\begin{align}
S_n=&\frac{12-7\sqrt{3}}{6}(2-\sqrt{3})^{n-1}+\frac{12+7\sqrt{3}}{6}(2+\sqrt{3})^{n-1}\\
=&-\frac{\sqrt{3}}{6}(2-\sqrt{3})^{n+1}+\frac{\sqrt{3}}{6}(2+\sqrt{3})^{n+1}
\end{align}
$$
从而$\forall n\geq 2$，
$$
A_n=S_n-S_{n-1}=\frac{3-\sqrt{3}}{6}(2-\sqrt{3})^n+\frac{3+\sqrt{3}}{6}(2+\sqrt{3})^n
$$
对$n=1$也成立。因此所有可能的铺砖数就为$A_n$，$n\geq 1$。

#### （2）

由（1），有
$$
B_n=A_{n-1}+B_{n-1}=A_{n-1}+A_{n-2}+B_{n-2}=\cdots=\sum_{i=1}^{n-1}A_i+B_1=S_{n-1}
$$
因此
$$
B_n=-\frac{\sqrt{3}}{6}(2-\sqrt{3})^{n}+\frac{\sqrt{3}}{6}(2+\sqrt{3})^{n}
$$
设$C_n$表示铺设$1\times n$路径的总砖块数，$D_n$表示铺设$1\times n$路径，但最后一个$1\times 1$方块只有按对角线分隔开的一半时的总砖块数。

1. 对$C_n$​，考虑最后一块砖如何铺设。可以铺设一块方砖，或是直角顶点在左上角和右下角的直角边长为1的等腰直角三角形砖，三种情况对应的铺砖数分别为$C_{n-1}+A_{n-1}$，$D_n+B_n$，$D_n+B_n$。
2. 对$D_n$，同样考虑最后一块砖如何铺设，可以铺设一块直角边长为1的等腰直角三角形砖，或是斜边长为2的等腰直角三角形砖，两种情况对应的铺砖方案数分别为$C_{n-1}+A_{n-1}$，$D_{n-1}+B_{n-1}$。

故我们得到两个递推关系，即
$$
\begin{cases}
C_n=C_{n-1}+A_{n-1}+2D_n+2B_n\\
D_n=C_{n-1}+A_{n-1}+D_{n-1}+B_{n-1}
\end{cases}
$$
从而有
$$
\begin{align}
C_n=&C_{n-1}+A_{n-1}+2B_n+2D_n\\
=&C_{n-1}+2C_{n-1}+A_{n-1}+2A_{n-1}+2B_n+2B_{n-1}+2D_{n-1}\\
\vdots&\\
=&C_{n-1}+2\sum_{i=1}^{n-1}C_i+A_{n-1}+2\sum_{i=1}^{n-1}A_{i}+2\sum_{i=1}^nB_i+2D_1
\end{align}
$$
而
$$
\begin{align}
A_{n-1}+2\sum_{i=1}^{n-1}A_i=&A_n-2=\frac{3-\sqrt{3}}{6}(2-\sqrt{3})^n+\frac{3+\sqrt{3}}{6}(2+\sqrt{3})^n-2\\
D_1=&1\\
\sum_{i=1}^nB_i=&-\frac{\sqrt{3}}{6}\sum_{i=1}^n(2-\sqrt{3})^i+\frac{\sqrt{3}}{6}\sum_{i=1}^n(2+\sqrt{3})^n\\
=&-\frac{1}{2}+\frac{3+\sqrt{3}}{12}(2-\sqrt{3})^{n+1}+\frac{3-\sqrt{3}}{12}(2+\sqrt{3})^{n+1}\\
=&-\frac{1}{2}+\frac{3-\sqrt{3}}{12}(2-\sqrt{3})^{n}+\frac{3+\sqrt{3}}{12}(2+\sqrt{3})^n
\end{align}
$$
故
$$
C_n=C_{n-1}+2\sum_{i=1}^{n-1}C_i+\frac{3-\sqrt{3}}{3}(2-\sqrt{3})^n+\frac{3+\sqrt{3}}{3}(2+\sqrt{3})^n-1
$$
令$S_n=\sum_{i=1}^nC_i-\frac{1}{2}$，则上式化为
$$
S_n-4S_{n-1}+S_{n-2}=\frac{3-\sqrt{3}}{3}(2-\sqrt{3})^{n}+\frac{3+\sqrt{3}}{3}(2+\sqrt{3})^n,\quad n\geq 3
$$
把$n$换成$n-1$，得到
$$
S_{n-1}-4S_{n-2}+S_{n-3}=\frac{3-\sqrt{3}}{3}(2-\sqrt{3})^{n-1}+\frac{3+\sqrt{3}}{3}(2+\sqrt{3})^{n-1},\quad n\geq 4
$$
联立着两个方程，消去$(2-\sqrt{3})^n$，得到：
$$
\frac{\sqrt{3}}{6}S_n-(\sqrt{3}-\frac{1}{2})S_{n-1}+(\frac{3\sqrt{3}}{2}-2)S_{n-2}-(\frac{\sqrt{3}}{3}-\frac{1}{2})S_{n-3}=\frac{3+\sqrt{3}}{3}(2+\sqrt{3})^n
$$
把$n$换成$n-1$，和上式联立，消去$(2+\sqrt{3})^n$，得到
$$
S_n-8S_{n-1}+18S_{n-2}-8S_{n-3}+S_{n-4}=0,\quad n\geq 5
$$
其特征方程为
$$
x^4-8x^3+18x^2-8x+1=0\Longleftrightarrow (x^2-4x+1)^2=0
$$
其有两个根：
$$
x_1=2-\sqrt{3},\quad x_2=2+\sqrt{3}
$$
均为二重根。因此可设：
$$
S_n=(X(n-2)+Y)(2-\sqrt{3})^{n-2}+(U(n-2)+V)(2-\sqrt{3})^{n-2}
$$
计算得到$S$的初值如下：

| 下标$i$ | $A_i$ | $B_i$ | $C_i$ | $D_i$ | $S_i=\sum_{j=1}^iC_j-\frac{1}{2}$ |
| ------- | ----- | ----- | ----- | ----- | ------ |
| 1       | 3     | 1     | 5     | 1     | 4.5    |
| 2       | 11    | 4     | 36    | 10    | 40.5   |
| 3       | 41    | 15    | 199   | 61    | 239.5  |
| 4       | 153   | 56    | 984   | 316   | 1223.5 |

代入$S_1,S_2,S_3,S_4$至$S_n$的通项表达式，由待定系数法，得
$$
\begin{cases}
X=\frac{71}{6}-\frac{41}{6}\sqrt{3}\\
Y=\frac{81}{4}-\frac{421}{36}\sqrt{3}\\
U=\frac{71}{6}+\frac{41}{6}\sqrt{3}\\
V=\frac{81}{4}+\frac{421}{36}\sqrt{3}\\
\end{cases}
$$
也即
$$
S_n=[(\frac{71}{6}-\frac{41}{6}\sqrt{3})n-\frac{41}{12}+\frac{71}{36}\sqrt{3}](2-\sqrt{3})^{n-2}+[(\frac{71}{6}+\frac{41}{6}\sqrt{3})n-\frac{41}{12}-\frac{71}{36}\sqrt{3}](2+\sqrt{3})^{n-2}
$$
经验证，可知$S_n$满足上述初值条件以及递归方程。

从而$\forall n\geq 2$，
$$
\begin{align}
&C_n=S_n-S_{n-1}\\
=&[(\frac{97}{3}-\frac{56}{3}\sqrt{3})n+\frac{5}{2}-\frac{13}{9}\sqrt{3}](2-\sqrt{3})^{n-3}+[(\frac{97}{3}+\frac{56}{3}\sqrt{3})n+\frac{5}{2}+\frac{13}{9}\sqrt{3}](2+\sqrt{3})^{n-3}\\
=&(\frac{2-\sqrt{3}}{3}n-\frac{\sqrt{3}}{18})(2-\sqrt{3})^n+(\frac{2+\sqrt{3}}{3}n+\frac{\sqrt{3}}{18})(2+\sqrt{3})^n\\
\end{align}
$$
这对$n=1$也成立。从而铺设$1\times n$的路径时，每一种可能的铺砖方案中使用的砖数总和即为$C_n$。

### Q4.11

> 难度：4。计算量很小，但是思维难度较高。这道题我是从概率论里的一个恒等式得到的灵感。设$X$是一个离散型随机变量，取值为正整数且$\in[1,k]$，则有如下等式成立：
> $$
> EX=\sum_{n=1}^{k}nP(X=n)=\sum_{n=1}^{k}P(X\geq n)
> $$
> 就本题而言，设$P(X=n)$为随机选一个盒子，其中恰好放着$n$个球的概率，$\sum_{n=1}^{k}nP(X=n)$就对应着场景一，$\sum_{n=1}^{k}P(X\geq n)$就对应着场景二，通过这种港式，我们就可以将放球的方案转换为$k$个不超过$m$的正整数相加。

#### （1）

**证明**：首先，对$m=1$，有$f(n,1)=1=g(n,1)$。下设$m\geq 2$，考虑递推关系：

1. $f(n,m)$：设放在$m$个盒子中的最少球数为$k$，则$0\leq k\leq\lfloor\frac{n}{m}\rfloor$。此时从所有盒子中均移走$k$个球，则必出现空盒。此时去掉这个空盒，则方案数等价于将$n-mk$个球放入$m-1$个盒子中，且允许出现空盒，即方案数为$f(n-mk,m-1)$。所以有
   $$
   f(n,m)=\sum_{k=0}^{\lfloor\frac{n}{m}\rfloor}f(n-mk,m-1)
   $$

2. $g(n,m)$：考虑最大值$m$出现的次数$k$，有$0\leq k\leq\lfloor\frac{n}{m}\rfloor$。去掉这$k$个最大值后，剩下所有数的和为$n-mk$，最大值为$m-1$，对应方案数为$g(n-mk,m-1)$。所以有
   $$
   g(n,m)=\sum_{k=0}^{\lfloor\frac{n}{m}\rfloor}g(n-mk,m-1)
   $$

由上可知，$f(n,m)$和$g(n,m)$的递推关系一样，初值条件也一样，因此$f(n,m)=g(n,m)$。

#### （2）

考虑场景（I）下的任意一种合法情况：设放在$m$个盒子中的球数为$a_1,a_2,\cdots,a_m$，有$a_i\geq 0$，$1\leq i\leq m$。设$k=\max\set{a_i}_{1\leq i\leq m}$，令$b_j=\sum_{i=1}^m\mathcal{1}_{a_i\geq j}$，其中$1\leq j\leq k$, $\mathcal{1}_{a_i\geq j}=\begin{cases}1, &a_i\geq j\\ 0,& a_i<j\end{cases}$  。也即，$b_j$表示$\set{a_i}$中不小于$j$的个数，所以有$b_j\leq m$，$1\leq j\leq k$。此时：
$$
\sum_{j=1}^kb_j=\sum_{j=1}^k\sum_{i=1}^m\mathcal{1}_{a_i\geq j}=\sum_{i=1}^ma_i=n
$$
因此$\set{b_1,b_2,\cdots,b_k}$是场景（II）下的一种合法情况。并且有$b_1\geq b_2\geq\cdots\geq b_k$。显然这种映射下不存在两个$\set{a_i}$映射到同一组$\set{b_j}$。

反过来，考虑场景（II）下的任意一种合法情况，设将$n$拆分为$b_1,b_2,\cdots,b_k$的和，其中$b_1\geq b_2\geq \cdots\geq b_k$，且$1\leq b_j\leq m$，$1\leq j\leq k$，$k\geq 1$。令$b_{k+1}=0$。取数列$A=\set{a_i}$，使得其中数字$i$的个数等于$b_i-b_{i+1}$，$1\leq i\leq k$。设$N$表示$A$中数字的数量，则
$$
N=\sum_{i=1}^kb_i-b_{i+1}=b_1\leq m
$$
且
$$
\sum_{i=1}^Na_i=\sum_{i=1}^ki\cdot(b_i-b_{i+1})=\sum_{i=1}^kb_i=n
$$
扩增$\set{a_i}_{1\leq i\leq N}$至$\set{a_i}_{1\leq i\leq m}$，使得$a_{N+1},a_{N+2},\cdots,a_m$均为0，并设$a_i$表示第$i$个盒子中放的球数，$1\leq i\leq m$，则$\set{a_i}_{1\leq i\leq N}$就是场景（I）下的一种合法情况。显然这种映射下也不存在两个$\set{b_j}$映射到同一组$\set{a_i}$。

综上，我们在场景（I）的放球方案和场景（II）的每个拆分方案之间建立了一一对应关系，从而$f(n,m)=g(n,m)$。

### Q4.12

> 难度：3。计算量较大，但是思维难度不大，仔细对与$n$模4的值分类讨论即可。

由题，$\forall n\geq 2$，有
$$
\begin{align}
a_n=&3a_{n-1}-2a_{n-2}+3\sin\frac{n\pi}{2}\\
a_{n+1}=&3a_n-2a_{n-1}+3\sin\frac{(n+1)\pi}{2}\\
a_{n+2}=&3a_{n+1}-2a_n+3\sin\frac{(n+2)\pi}{2}\\
a_{n+3}=&3a_{n+2}-2a_{n+1}+3\sin\frac{(n+3)\pi}{2}
\end{align}
$$
将四式相加，并令$S_n=a_n+a_{n+1}+a_{n+2}+a_{n+3}$，$n\geq 0$，得
$$
S_n=3S_{n-1}-2S_{n-2},\quad n\geq 2
$$
其对应的特征方程为
$$
x^2-3x+2=0
$$
对应两个解$x_1=1$，$x_2=2$。从而设
$$
S_n=A+B2^n,n\geq 0
$$
考虑$S$的初值，有$a_0=5,a_1=3,a_2=-1,a_3=-12,a_4=-34,a_5=-75$，则$S_0=-5,S_1=-44$。利用待定系数法得到
$$
S_n=34-39\times 2^n
$$
经验证，这满足上述的递归方程以及初值条件。

令$T_n=\sum_{i=1}^na_i$。对$n$模4的余数分类讨论。设$k\geq 0$，有

1. $n=4k$，则$T_{4k}=a_0+\sum_{i=0}^{k-1}S_{4i+1}=5+\sum_{i=0}^{k-1}(34-39\times 2^{4i+1})=5+34k-\frac{78}{15}(16^k-1)$。
2. $n=4k+1$，则$T_{4k+1}=a_0+a_1+\sum_{i=0}^{k-1}S_{4i+2}=8+\sum_{i=0}^{k-1}(34-39\times 2^{4i+2})=8+34k-\frac{156}{15}(16^k-1)$。
3. $n=4k+2$，则$T_{4k+2}=a_0+a_1+a_2+\sum_{i=0}^{k-1}S_{4i+3}=7+\sum_{i=0}^{k-1}(34-39\times 2^{4i+3})=7+34k-\frac{312}{15}(16^k-1)$。
4. $n=4k+3$，则$T_{4k+3}=\sum_{i=0}^{k}S_{4i}=\sum_{i=0}^k(34-39\times 2^{4i})=34+34k-\frac{39}{15}(16^{k+1}-1)$。

从而$\forall k\geq 0$，有
$$
a_n=\begin{cases}
T_{4k}-T_{4k-1}=\frac{38}{5}-\frac{13}{5}16^k,&n=4k\quad(虽然这要求k\geq 1,但注意到这对k=0也成立)\\
T_{4k+1}-T_{4k}=\frac{41}{5}-\frac{26}{5}16^k,&n=4k+1\\
T_{4k+2}-T_{4k+1}=\frac{47}{5}-\frac{52}{5}16^k,&n=4k+2\\
T_{4k+3}-T_{4k+2}=\frac{44}{5}-\frac{104}{5}16^k,&n=4k+3
\end{cases}
$$

### Q4.13

> 难度：2。只要知道行列式的表达式，感觉就很简单了。需要注意特征方程重根的情况，分别进行讨论

设如题所示的$n$阶行列式的值为$a_n$，$n\geq 1$。根据行列式的定义，有
$$
a_n=pa_{n-1}-(p-q)qa_{n-2},\quad n\geq 2
$$
对应特征方程
$$
x^2-px+(p-q)q=0
$$
对应两个根为
$$
x_1=p-q,\space x_2=q
$$
且有初值条件$a_1=|p|=p$，$a_2=\begin{vmatrix}p&p-q\\q&p\end{vmatrix}=p^2-pq+q^2$

1. 若$p=2q$，则$x_1=x_2$，此时设$a_n=(A(n-1)+B)q^{n-1}$，代入$a_1,a_2$，得
   $$
   a_n=(n+1)q^{n}
   $$

2. 若$p\neq 2q$，则$x_1\neq x_2$，此时设$a_n=A(p-q)^{n-1}+Bq^{n-1}$，代入$a_1,a_2$，得
   $$
   a_n=\frac{1}{p-2q}(p-q)^{n+1}-\frac{1}{p-2q}q^{n+1}
   $$

综上，有
$$
a_n=\begin{cases}
(n+1)q^n,&p=2q\\
\frac{1}{p-2q}(p-q)^{n+1}-\frac{1}{p-2q}q^{n+1},&p\neq 2q
\end{cases}
$$

### Q4.14

> 难度：3。相对比较常规，关键应该是考虑到对称性，想到$2,3,\cdots,m$这些位置是本质上相同的。

由题意，一共有$m$个位置，设为$1,2,3,\cdots,m$，其中初始位置位于1。由对称性，走$n$步后到达$2,3,\cdots,m$这些位置的不同路径数目应当相等，设为$g(n)$，$n\geq 0$。设走$n$步后到达位置1的不同路径的数目为$f(n)$，$n\geq 0$。显然有$f(0)=1$，$g(0)=0$。考虑递推。

1. 若要在第$n$步到达位置1，则第$n-1$步必须位于位置$2,3,\cdots, m$中之一，之后在第$n$步走到位置$1$。因此有
   $$
   f(n)=(m-1)g(n-1),\quad n\geq 1
   $$

2. 若要在第$n$步到达位置$2,3,\cdots,m$中的一个，设为$k$，则第$n-1$步必须不落在$k$位置。而根据假设，第$n-1$步落在位置1的不同路径数目为$f(n-1)$，落在$2,3,\cdots,k-1,k+1,\cdots,m$的不同路径数均为$g(n-1)$，因此有
   $$
   g(n)=f(n-1)+(m-2)g(n-1),\quad n\geq 1
   $$

将上两个式子相减，得到
$$
f(n)-g(n)=-(f(n-1)-g(n-1))=\cdots=(-1)^n(f(0)-g(0))=(-1)^n,\quad n\geq 0
$$
所以有
$$
\begin{align}
f(n)=&(m-1)g(n-1)=(m-1)[f(n-1)-(-1)^{n-1}]\\
=&(m-1)f(n-1)-(m-1)(-1)^{n-1}\\
=&(m-1)^2f(n-2)-(m-1)^2(-1)^{n-2}-(m-1)(-1)^{n-1}\\
\vdots&\\
=&(m-1)^nf(0)-\sum_{k=1}^n(m-1)^k(-1)^{n-k}\\
=&(m-1)^n-\sum_{k=1}^n(m-1)^k(-1)^{n+k}\\
=&(m-1)^n-\frac{(m-1)(-1)^{n+1}(1-(-(m+1))^{n+1})}{1-(-(m-1))}\\
=&\frac{(m-1)^n+(m-1)(-1)^n}{m},\quad n\geq 0
\end{align}
$$
此即为移动$n$次后仍然回到位置1的不同路径数目。
